<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strava PBs</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/png" href="favicon.png">
</head>
<body>
<div class="win95-container">
    <!-- Windows 95 Title Bar -->
    <div class="win95-title-bar">
        <div class="win95-title">Strava Personal Bests</div>
        <div class="win95-buttons">
            <button class="win95-button win95-minimize">_</button>
            <button class="win95-button win95-maximize">â–¡</button>
            <button class="win95-button win95-close">Ã—</button>
        </div>
    </div>

    <!-- Windows 95 Menu Bar -->
    <div class="win95-menu-bar">
        <div class="win95-menu-item" id="home-link">Home</div>
        <div class="win95-menu-item">File</div>
        <div class="win95-menu-item">Edit</div>
        <div class="win95-menu-item">View</div>
        <div class="win95-menu-item">Help</div>
    </div>

    <!-- Content Area -->
    <div class="win95-content">
        <div class="marquee">
            <span class="blink">&#9733;</span> My Running Personal Bests <span class="blink">&#9733;</span>
        </div>

        <h1>Powered by Strava API</h1>

        <div class="refresh-time" id="lastUpdated"></div>

        <div id="loading" class="win95-box loading-box">
            <div class="win95-spinner"></div>
            <p>Loading personal bests...</p>
        </div>

        <div class="pb-container" id="pbCards">
            <!-- PB cards will be generated here -->
        </div>

        <div class="win95-status-bar">
            <div class="status-bar-top">
                <div class="status-item">Page loaded successfully</div>
                <div class="status-item">Visitors: 1,337</div>
                <div class="status-item">Last updated: August 24, 1995</div>
                <div class="status-item">
                    <button class="win95-sound-button" id="sound-toggle" title="Toggle Sound">ðŸ”Š</button>
                </div>
            </div>
            <div class="status-bar-bottom">
                <div class="faith-message">
                    Jesus Christ is the Light and Saviour of the world!
                    <a href="https://www.bible.com/" target="_blank">Discover His Love</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', async () => {
        try {
            const response = await fetch('./data/strava-pbs.json');
            const data = await response.json();

            const { personalBests, lastUpdated } = data;

            // Update last updated time
            if (lastUpdated) {
                const date = new Date(lastUpdated);
                document.getElementById('lastUpdated').textContent = `Last updated: ${date.toLocaleString()}`;
            }

            // Hide loading indicator
            document.getElementById('loading').style.display = 'none';

            // Create cards for each personal best
            const pbCardsContainer = document.getElementById('pbCards');

            // Nice display names for distances
            const distanceNames = {
                '1k': '1 Kilometer',
                '5k': '5 Kilometers',
                '10k': '10 Kilometers',
                '1_mile': '1 Mile',
                'half_marathon': 'Half Marathon',
                'marathon': 'Marathon'
            };

            // Sort distances by increasing length
            const distanceOrder = ['1k', '1_mile', '5k', '10k', 'half_marathon', 'marathon'];
            const sortedDistances = Object.keys(personalBests)
                .sort((a, b) => distanceOrder.indexOf(a) - distanceOrder.indexOf(b));

            // Create Windows 95 style boxes for each PB
            sortedDistances.forEach(distance => {
                const pb = personalBests[distance];
                const date = new Date(pb.start_date);

                const pbBox = document.createElement('div');
                pbBox.className = 'pb-box';
                pbBox.innerHTML = `
                    <div class="pb-title-bar">
                        ${distanceNames[distance] || distance}
                    </div>
                    <div class="pb-content">
                        <div class="pb-time strava-orange">${pb.formatted_time}</div>
                        <ul class="pb-details">
                            <li>
                                <span>Pace:</span> <strong>${pb.formatted_pace}</strong>
                            </li>
                            <li>
                                <span>Date:</span> <strong>${date.toLocaleDateString()}</strong>
                            </li>
                            <li>
                                <span>Activity:</span> <strong>${pb.name}</strong>
                            </li>
                        </ul>
                        <div class="button-container">
                            <a href="${pb.strava_url}" class="strava-link win95-button-large" target="_blank">
                                View on Strava
                            </a>
                        </div>
                    </div>
                `;

                pbCardsContainer.appendChild(pbBox);
            });

            // Show a message if no PBs are found
            if (sortedDistances.length === 0) {
                pbCardsContainer.innerHTML = `
                    <div class="win95-box">
                        <div class="section-content">
                            No personal bests found yet. Make sure you have running activities in your Strava account.
                        </div>
                    </div>
                `;
            }

        } catch (error) {
            console.error('Error loading data:', error);
            document.getElementById('loading').innerHTML = `
                <div class="win95-box">
                    <div class="section-content">
                        Error loading personal bests data. Please check the console for details.
                    </div>
                </div>
            `;
        }
    });

    document.getElementById('home-link').addEventListener('click', function() {
        // Set a session storage flag to indicate internal navigation
        sessionStorage.setItem('internalNavigation', 'true');
        // Navigate to the home page without extension
        window.location.href = './index';
    });
</script>
</body>
</html>